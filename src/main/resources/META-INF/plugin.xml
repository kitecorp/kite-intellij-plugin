<!-- Plugin Configuration File. Read more: https://plugins.jetbrains.com/docs/intellij/plugin-configuration-file.html -->
<idea-plugin>
    <!-- Unique identifier of the plugin. It should be FQN. It cannot be changed between the plugin versions. -->
    <id>io.kite.intellij-plugin</id>

    <!-- Public plugin name should be written in Title Case.
         Guidelines: https://plugins.jetbrains.com/docs/marketplace/plugin-overview-page.html#plugin-name -->
    <name>Kite</name>

    <!-- A displayed Vendor name or Organization ID displayed on the Plugins Page. -->
    <vendor email="support@echostream.ro" url="https://github.com/kitecorp">EchoStream SRL</vendor>

    <!-- Description of the plugin displayed on the Plugin Page and IDE Plugin Manager.
         Simple HTML elements (text formatting, paragraphs, and lists) can be added inside of <![CDATA[ ]]> tag.
         Guidelines: https://plugins.jetbrains.com/docs/marketplace/plugin-overview-page.html#plugin-description -->
    <description><![CDATA[
    Support for the Kite Infrastructure as Code (IaC) language.
    <br/>
    <br/>
    Kite is a modern IaC programming language designed as an alternative to Terraform,
    featuring multi-cloud provisioning, strong typing, and a clean syntax.
    <br/>
    <br/>
    Features:
    <ul>
      <li><b>Syntax Highlighting</b> - Full lexical and semantic highlighting for .kite files with type-aware coloring</li>
      <li><b>Go to Declaration</b> - Cmd+Click (Mac) or Ctrl+Click (Win/Linux) to navigate from identifier usages to their declarations. Supports:
        <ul>
          <li>Simple identifiers: click <code>server</code> to jump to <code>resource VM.Instance server { }</code></li>
          <li>Property access: click <code>size</code> in <code>server.size</code> to jump to the <code>size = ...</code> property inside the server declaration</li>
          <li>String interpolation: click <code>port</code> in <code>"${port}"</code> or <code>"$port"</code> to jump to the declaration (only the variable is underlined, not the entire string)</li>
        </ul>
      </li>
      <li><b>Find Usages</b> - Cmd+Click on a declaration name shows a dropdown of all usages with:
        <ul>
          <li>Context-aware icons (Resource, Component, Function, etc.)</li>
          <li>Full line of code preview</li>
          <li>File name and line number</li>
        </ul>
      </li>
      <li><b>Rename Refactoring</b> - Use Shift+F6 (or Refactor > Rename) to rename identifiers across the file:
        <ul>
          <li>Renames declarations and all their usages simultaneously</li>
          <li>Supports variables, inputs, outputs, resources, components, schemas, and functions</li>
          <li>Also renames references in string interpolation (<code>$var</code> and <code>${var}</code>)</li>
          <li>Validates new names against Kite identifier rules and keywords</li>
        </ul>
      </li>
      <li><b>Structure View</b> - Hierarchical outline with color-coded icons for resources, components, schemas, functions, types, variables, inputs, outputs, and imports</li>
      <li><b>Code Folding</b> - Collapse and expand declarations (components, resources, schemas, functions), control flow statements (for, while), object literals, and comments</li>
      <li><b>Code Formatting</b> - Automatic code formatting with 'Reformat Code' action (Cmd+Alt+L / Ctrl+Alt+L) including vertical alignment of object properties and declarations</li>
      <li><b>Comment/Uncomment</b> - Toggle line and block comments with keyboard shortcuts (Cmd+/ or Ctrl+/)</li>
      <li><b>Brace Matching</b> - Automatic highlighting of matching braces, brackets, and parentheses</li>
      <li><b>Breadcrumbs</b> - Navigation path showing current location (e.g., component > resource > property) at top/bottom of editor</li>
      <li><b>Custom Color Scheme</b> - Configurable syntax colors for keywords, types, literals, comments, and more via Settings > Editor > Color Scheme > Kite</li>
      <li><b>Quick Documentation</b> - Press Ctrl+Q (Windows/Linux) or F1 (Mac) on any declaration to view documentation:
        <ul>
          <li>Shows declaration kind, name, type, and default value</li>
          <li>Displays decorators and preceding comments</li>
          <li>Components show all inputs and outputs with their types and defaults</li>
          <li>Resources show their resource type (e.g., <code>VM.Instance</code>)</li>
          <li>Works with identifiers and string interpolation (<code>${var}</code> and <code>$var</code>)</li>
          <li>Syntax-highlighted with colors matching the editor theme</li>
        </ul>
      </li>
      <li><b>Inlay Hints</b> - Inline type and parameter hints displayed directly in the editor:
        <ul>
          <li>Type hints for variables without explicit type annotation (e.g., <code>var x = "hello"</code> shows <code>:string</code>)</li>
          <li>Supports string, number, boolean, null, object, and array literals</li>
          <li>Parameter name hints in function calls (e.g., <code>greet("Alice", 30)</code> shows <code>name:</code> and <code>age:</code>)</li>
          <li>Configurable via Settings > Editor > Inlay Hints > Kite</li>
        </ul>
      </li>
      <li><b>TODO/FIXME Highlighting</b> - TODO, FIXME, and other task patterns are highlighted in comments and appear in the TODO tool window</li>
      <li><b>File Templates</b> - Create new .kite files from the New menu (File > New > Kite File or right-click > New > Kite File)</li>
      <li><b>Live Templates</b> - Code snippets that expand to common patterns. Type abbreviation + Tab:
        <ul>
          <li><code>comp</code> → component block</li>
          <li><code>res</code> → resource block</li>
          <li><code>sch</code> → schema block</li>
          <li><code>fun</code> → function definition</li>
          <li><code>inp</code> → input declaration</li>
          <li><code>out</code> → output declaration</li>
          <li><code>var</code> → variable declaration</li>
          <li><code>for</code> → for loop</li>
          <li><code>if</code> / <code>ife</code> → if / if-else statements</li>
          <li><code>type</code> → type alias</li>
          <li><code>imp</code> → import statement</li>
          <li><code>s3</code> → S3 Bucket resource</li>
          <li><code>vm</code> → VM Instance resource</li>
          <li><code>compfull</code> → complete component with inputs, resource, and output</li>
        </ul>
      </li>
      <li><b>Parameter Info</b> - Press Ctrl+P (Windows/Linux) or Cmd+P (Mac) inside a function call to see parameter hints:
        <ul>
          <li>Shows function parameter names and types</li>
          <li>Highlights the current parameter based on cursor position</li>
          <li>Updates as you type or move through arguments</li>
        </ul>
      </li>
      <li><b>Type Checking & Error Highlighting</b> - Real-time validation with warnings and errors:
        <ul>
          <li>Undefined reference detection: warns when identifiers don't resolve to any declaration</li>
          <li>Type mismatch detection: error when assigned value type doesn't match declared type</li>
          <li>Checks variable, input, and output declarations with explicit types</li>
          <li>Supports string, number, boolean, null, object, any, and array types (<code>string[]</code>, <code>number[]</code>, etc.)</li>
        </ul>
      </li>
      <li><b>Cross-file Navigation</b> - Go to Declaration across files:
        <ul>
          <li>Follow imports to navigate to declarations in other files</li>
          <li>Cmd+Click (Mac) or Ctrl+Click (Win/Linux) on identifiers from imported modules</li>
          <li>Supports <code>import * from "path/to/file.kite"</code> syntax</li>
          <li>Automatically resolves relative paths from the current file</li>
          <li>Recursive import resolution for transitive dependencies</li>
        </ul>
      </li>
    </ul>
  ]]></description>

    <!-- Short summary of new features and bugfixes in the latest version -->
    <change-notes><![CDATA[
    <b>0.15.0</b>
    <ul>
      <li><b>Array Types</b> - Full support for array type syntax
        <ul>
          <li>Declare variables with array types: <code>var string[] names</code></li>
          <li>Function parameters: <code>fun process(number[] items)</code></li>
          <li>Return types: <code>fun getData() string[] { }</code></li>
          <li>Schema properties: <code>string[] tags</code></li>
          <li>Code completion suggests array types (<code>string[]</code>, <code>number[]</code>, etc.)</li>
          <li>Syntax highlighting correctly identifies array types in all contexts</li>
        </ul>
      </li>
    </ul>
    <b>0.14.0</b>
    <ul>
      <li><b>Code Completion Improvements</b> - Context-aware autocomplete in resource blocks
        <ul>
          <li>Before <code>=</code>: shows only schema properties relevant to the resource type</li>
          <li>After <code>=</code>: shows variables, inputs, outputs, resources, components, and functions as values</li>
          <li>Functions now display with correct names (not return types)</li>
          <li>Already-defined properties are filtered out from completion suggestions</li>
        </ul>
      </li>
      <li><b>Resource Property Navigation</b> - Cmd+Click on a property name inside a resource block navigates to the property definition in the schema
        <ul>
          <li>Works with schemas in the same file or imported files</li>
          <li>Example: clicking <code>host</code> in <code>resource DatabaseConfig { host = "..." }</code> navigates to <code>string host</code> in the schema</li>
        </ul>
      </li>
      <li><b>Resource Property Hints</b> - Shows type hints for resource properties based on their schema definition</li>
      <li><b>Syntax Highlighting Fixes</b>
        <ul>
          <li>Component definition names (<code>component MyComp { }</code>) now use default text color</li>
          <li>Component instantiation types (<code>component TypeName instanceName { }</code>) correctly highlighted as types (blue)</li>
        </ul>
      </li>
      <li><b>Structure View Icons</b> - OUTPUT icon now uses distinct lime yellow-green color (vs INPUT amber yellow) for easier differentiation</li>
      <li><b>Find Usages Enhancement</b> - Cmd+Click on a declaration now shows usages inside string interpolations (<code>$var</code> and <code>${var}</code>)</li>
    </ul>
    <b>0.13.0</b>
    <ul>
      <li><b>Cross-file Navigation</b> - Go to Declaration across files
        <ul>
          <li>Follow imports to navigate to declarations in other files</li>
          <li>Cmd+Click (Mac) or Ctrl+Click (Win/Linux) on identifiers from imported modules</li>
          <li>Supports <code>import * from "path/to/file.kite"</code> syntax</li>
          <li>Automatically resolves relative paths from the current file</li>
          <li>Recursive import resolution for transitive dependencies</li>
        </ul>
      </li>
    </ul>
    <b>0.12.0</b>
    <ul>
      <li><b>Type Checking & Error Highlighting</b> - Real-time validation with warnings and errors
        <ul>
          <li>Undefined reference detection: warns when identifiers don't resolve to any declaration</li>
          <li>Type mismatch detection: error when assigned value type doesn't match declared type</li>
          <li>Checks variable, input, and output declarations with explicit types</li>
          <li>Supports string, number, boolean, null, object, and array types</li>
        </ul>
      </li>
    </ul>
    <b>0.11.0</b>
    <ul>
      <li><b>Parameter Info</b> - Press Ctrl+P (Windows/Linux) or Cmd+P (Mac) inside a function call to see parameter hints
        <ul>
          <li>Shows function parameter names and types from the declaration</li>
          <li>Highlights the current parameter based on cursor position</li>
          <li>Updates as you type or move through arguments</li>
        </ul>
      </li>
    </ul>
    <b>0.10.0</b>
    <ul>
      <li><b>Live Templates</b> - Code snippets that expand to common Kite patterns
        <ul>
          <li>Type abbreviation + Tab to expand (e.g., <code>comp</code> + Tab → component block)</li>
          <li>Includes templates for: component, resource, schema, function, input, output, var, for, if, if-else, type alias, import, decorator</li>
          <li>Resource-specific templates: <code>s3</code> for S3 Bucket, <code>vm</code> for VM Instance</li>
          <li><code>compfull</code> creates a complete component with inputs, resource, and output</li>
          <li>Tab through placeholders to fill in values</li>
        </ul>
      </li>
    </ul>
    <b>0.9.0</b>
    <ul>
      <li><b>File Templates</b> - Create new .kite files from the New menu
        <ul>
          <li>File > New > Kite File or right-click > New > Kite File</li>
          <li>Creates a new .kite file with optional component boilerplate</li>
        </ul>
      </li>
    </ul>
    <b>0.8.0</b>
    <ul>
      <li><b>Inlay Hints</b> - Inline type and parameter hints displayed in the editor
        <ul>
          <li>Type hints show inferred types for var declarations without explicit type annotation</li>
          <li>Supports string, number, boolean, null, object, and array literals</li>
          <li>Parameter name hints in function calls</li>
          <li>Configurable via Settings > Editor > Inlay Hints > Kite</li>
        </ul>
      </li>
      <li><b>TODO/FIXME Highlighting</b> - TODO, FIXME, and other patterns are highlighted in comments and appear in the TODO tool window</li>
    </ul>
    <b>0.7.0</b>
    <ul>
      <li><b>Quick Documentation</b> - Press Ctrl+Q (Windows/Linux) or F1 (Mac) on any declaration to view documentation
        <ul>
          <li>Shows declaration kind (Variable, Input, Output, Resource, Component, Schema, Function)</li>
          <li>Displays type, default value, and decorators for inputs/outputs/variables</li>
          <li>Components show all inputs and outputs with their types and defaults</li>
          <li>Resources show their full resource type (e.g., <code>VM.Instance</code>)</li>
          <li>Preceding comments are displayed at the end of the documentation</li>
          <li>Works with identifiers and string interpolation (<code>${var}</code> and <code>$var</code>)</li>
          <li>Syntax-highlighted with colors matching the editor theme</li>
        </ul>
      </li>
    </ul>
    <b>0.6.0</b>
    <ul>
      <li><b>Rename Refactoring</b> - Use Shift+F6 to rename identifiers across the file
        <ul>
          <li>Renames declarations and all their usages simultaneously</li>
          <li>Supports all declaration types: variables, inputs, outputs, resources, components, schemas, functions</li>
          <li>Also renames references in string interpolation (<code>$var</code> and <code>${var}</code>)</li>
          <li>Validates new names against Kite identifier rules and keywords</li>
        </ul>
      </li>
    </ul>
    <b>0.5.0</b>
    <ul>
      <li><b>Breadcrumbs Navigation</b> - Navigation path showing current location at top/bottom of editor
        <ul>
          <li>Shows hierarchical path: component > resource > property</li>
          <li>Object literals display their property names (e.g., <code>tag</code>, <code>New</code>)</li>
          <li>Supports all Kite declarations: components, resources, schemas, functions, types, variables</li>
        </ul>
      </li>
    </ul>
    <b>0.4.0</b>
    <ul>
      <li><b>Simple String Interpolation</b> - Navigate from <code>$variable</code> (without braces) to declarations
        <ul>
          <li>Both <code>${var}</code> and <code>$var</code> syntax now fully supported</li>
          <li>Cmd+Click on <code>$port</code> navigates to the port declaration</li>
        </ul>
      </li>
      <li><b>Code Completion</b> - Component references now show only output properties (not inputs)</li>
    </ul>
    <b>0.3.0</b>
    <ul>
      <li><b>String Interpolation Support</b> - Navigate from variables inside <code>${variable}</code> to their declarations
        <ul>
          <li>Only the variable name is underlined, not the entire string</li>
          <li><code>${</code> and <code>}</code> delimiters highlighted in orange</li>
        </ul>
      </li>
      <li><b>Formatter Fix</b> - Code formatter now preserves line breaks between declarations (var, input, output, etc.)</li>
    </ul>
    <b>0.2.0</b>
    <ul>
      <li><b>Go to Declaration</b> - Cmd+Click navigation to jump from identifier usages to their declarations</li>
      <li>Property access navigation: click <code>size</code> in <code>server.size</code> to navigate inside the declaration</li>
      <li><b>Find Usages</b> - Cmd+Click on a declaration name shows a dropdown of all usages with:
        <ul>
          <li>Context-aware colored icons (Resource, Component, Function, etc.)</li>
          <li>Full line of code preview</li>
          <li>File name and line number</li>
        </ul>
      </li>
      <li>Type-aware syntax highlighting: types shown in blue, other identifiers use default theme color</li>
    </ul>
    <b>0.1.0</b>
    <ul>
      <li>Fixed nested object literal indentation in code formatter</li>
      <li>Improved alignment for multi-line vs inline object literals</li>
      <li>Comments now properly break alignment groups</li>
      <li>Fixed schema property alignment with type annotations</li>
      <li>Better handling of VAR declaration alignment</li>
    </ul>
  ]]></change-notes>

    <!-- Product and plugin compatibility requirements.
         Read more: https://plugins.jetbrains.com/docs/intellij/plugin-compatibility.html -->
    <depends>com.intellij.modules.platform</depends>

    <!-- Extension points defined by the plugin.
         Read more: https://plugins.jetbrains.com/docs/intellij/plugin-extension-points.html -->
    <extensions defaultExtensionNs="com.intellij">
        <!-- File type registration -->
        <fileType name="Kite"
                  implementationClass="cloud.kitelang.intellij.KiteFileType"
                  fieldName="INSTANCE"
                  language="Kite"
                  extensions="kite"/>

        <!-- Parser definition -->
        <lang.parserDefinition language="Kite"
                               implementationClass="cloud.kitelang.intellij.parser.KiteParserDefinition"/>

        <!-- Syntax highlighter -->
        <lang.syntaxHighlighterFactory language="Kite"
                                       implementationClass="cloud.kitelang.intellij.highlighting.KiteSyntaxHighlighterFactory"/>

        <!-- Color settings page -->
        <colorSettingsPage implementation="cloud.kitelang.intellij.highlighting.KiteColorSettingsPage"/>

        <!-- Annotator for semantic highlighting -->
        <annotator language="Kite"
                   implementationClass="cloud.kitelang.intellij.highlighting.KiteAnnotator"/>

        <!-- Annotator for duplicate declaration detection -->
        <annotator language="Kite"
                   implementationClass="cloud.kitelang.intellij.highlighting.KiteDuplicateDeclarationAnnotator"/>

        <!-- Annotator for type checking and undefined reference detection -->
        <annotator language="Kite"
                   implementationClass="cloud.kitelang.intellij.highlighting.KiteTypeCheckingAnnotator"/>

        <!-- Structure view -->
        <lang.psiStructureViewFactory language="Kite"
                                      implementationClass="cloud.kitelang.intellij.structure.KiteStructureViewBuilderFactory"/>

        <!-- Commenter for comment/uncomment actions -->
        <lang.commenter language="Kite"
                        implementationClass="cloud.kitelang.intellij.KiteCommenter"/>

        <!-- Code folding support -->
        <lang.foldingBuilder language="Kite"
                             implementationClass="cloud.kitelang.intellij.KiteFoldingBuilder"/>

        <!-- Code formatter -->
        <lang.formatter language="Kite"
                        implementationClass="cloud.kitelang.intellij.formatter.KiteFormattingModelBuilder"/>

        <!-- Code style settings -->
        <langCodeStyleSettingsProvider implementation="cloud.kitelang.intellij.KiteLanguageCodeStyleSettingsProvider"/>

        <!-- Brace matching -->
        <lang.braceMatcher language="Kite"
                           implementationClass="cloud.kitelang.intellij.KiteBraceMatcher"/>

        <!-- Go to Declaration (Cmd+Click) -->
        <psi.referenceContributor language="Kite"
                                  implementation="cloud.kitelang.intellij.reference.KiteReferenceContributor"/>

        <!-- Go to Declaration handler -->
        <gotoDeclarationHandler implementation="cloud.kitelang.intellij.navigation.KiteGotoDeclarationHandler"/>

        <!-- Icon provider for navigation popups -->
        <iconProvider implementation="cloud.kitelang.intellij.navigation.KiteNavigationIconProvider"/>

        <!-- Highlight usages handler for identifier highlighting -->
        <highlightUsagesHandlerFactory
                implementation="cloud.kitelang.intellij.highlighting.KiteHighlightUsagesHandlerFactory"/>

        <!-- Code completion -->
        <completion.contributor language="Kite"
                                implementationClass="cloud.kitelang.intellij.completion.KiteCompletionContributor"/>

        <!-- Breadcrumbs navigation -->
        <breadcrumbsInfoProvider implementation="cloud.kitelang.intellij.KiteBreadcrumbsProvider"/>

        <!-- Rename refactoring support -->
        <lang.refactoringSupport language="Kite"
                                 implementationClass="cloud.kitelang.intellij.refactoring.KiteRefactoringSupportProvider"/>

        <!-- Names validator for identifiers -->
        <lang.namesValidator language="Kite"
                             implementationClass="cloud.kitelang.intellij.refactoring.KiteNamesValidator"/>

        <!-- Element manipulator for identifier renaming -->
        <lang.elementManipulator forClass="com.intellij.psi.impl.source.tree.LeafPsiElement"
                                 implementationClass="cloud.kitelang.intellij.refactoring.KiteIdentifierManipulator"/>

        <!-- Custom rename handler for Kite identifiers -->
        <renameHandler implementation="cloud.kitelang.intellij.refactoring.KiteRenameHandler"/>

        <!-- Quick documentation (Ctrl+Q / F1) -->
        <lang.documentationProvider language="Kite"
                                    implementationClass="cloud.kitelang.intellij.documentation.KiteDocumentationProvider"/>

        <!-- Inlay hints (type hints and parameter name hints) -->
        <codeInsight.inlayProvider language="Kite"
                                   implementationClass="cloud.kitelang.intellij.hints.KiteInlayHintsProvider"/>

        <!-- TODO/FIXME highlighting in comments -->
        <indexPatternBuilder implementation="cloud.kitelang.intellij.search.KiteIndexPatternBuilder"/>

        <!-- Internal file template for creating new Kite files -->
        <internalFileTemplate name="Kite File"/>

        <!-- Live Templates (code snippets) -->
        <defaultLiveTemplates file="/liveTemplates/Kite.xml"/>
        <liveTemplateContext contextId="Kite"
                             implementation="cloud.kitelang.intellij.templates.KiteLiveTemplateContext"/>

        <!-- Parameter Info (Ctrl+P) - Shows function parameter hints -->
        <codeInsight.parameterInfo language="Kite"
                                   implementationClass="cloud.kitelang.intellij.parameterinfo.KiteParameterInfoHandler"/>

        <!-- Quote auto-pairing (typing " or ' automatically inserts closing quote) -->
        <typedHandler implementation="cloud.kitelang.intellij.KiteQuoteHandler"/>

        <!-- Line markers for declarations (gutter icons showing usages) -->
        <codeInsight.lineMarkerProvider language="Kite"
                                        implementationClass="cloud.kitelang.intellij.navigation.KiteLineMarkerProvider"/>

    </extensions>

    <!-- Actions -->
    <actions>
        <!-- Add "New > Kite File" action to the New menu -->
        <action id="Kite.NewKiteFile"
                class="cloud.kitelang.intellij.actions.CreateKiteFileAction"
                text="Kite File"
                description="Create a new Kite infrastructure file">
            <add-to-group group-id="NewGroup" anchor="after" relative-to-action="NewFile"/>
        </action>
    </actions>
</idea-plugin>